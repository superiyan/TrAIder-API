// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("USER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  positions Position[]
  orders    Order[]
  trades    Trade[]
  settings  UserSettings?

  @@map("users")
}

model UserSettings {
  id                String   @id @default(uuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  theme             String   @default("light")
  language          String   @default("en")
  notifications     Boolean  @default(true)
  twoFactorEnabled  Boolean  @default(false)
  
  // Trading settings
  defaultLeverage   Int      @default(1)
  riskPerTrade      Float    @default(2.0)
  autoTradingEnabled Boolean @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("user_settings")
}

model Position {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  symbol          String
  side            String   // LONG or SHORT
  quantity        Float
  entryPrice      Float
  currentPrice    Float    @default(0)
  currentValue    Float    @default(0)
  unrealizedPnL   Float    @default(0)
  realizedPnL     Float    @default(0)
  
  leverage        Int      @default(1)
  marginUsed      Float
  liquidationPrice Float?
  
  status          String   @default("OPEN") // OPEN, CLOSED
  
  openedAt        DateTime @default(now())
  closedAt        DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("positions")
}

model Order {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  symbol      String
  type        String   // MARKET, LIMIT, STOP_LOSS, TAKE_PROFIT
  side        String   // BUY, SELL
  quantity    Float
  price       Float?
  stopPrice   Float?
  
  status      String   @default("PENDING") // PENDING, FILLED, PARTIALLY_FILLED, CANCELLED, REJECTED
  filledQty   Float    @default(0)
  avgPrice    Float?
  
  fee         Float    @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  executedAt  DateTime?

  trades      Trade[]

  @@map("orders")
}

model Trade {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  symbol      String
  side        String   // BUY, SELL
  quantity    Float
  price       Float
  total       Float
  fee         Float
  
  pnl         Float?
  
  executedAt  DateTime @default(now())

  @@map("trades")
}

model MarketData {
  id          String   @id @default(uuid())
  symbol      String
  
  open        Float
  high        Float
  low         Float
  close       Float
  volume      Float
  
  interval    String   // 1m, 5m, 15m, 1h, 4h, 1d
  timestamp   DateTime
  
  createdAt   DateTime @default(now())

  @@unique([symbol, interval, timestamp])
  @@map("market_data")
}

model AISignal {
  id          String   @id @default(uuid())
  symbol      String
  
  signal      String   // BUY, SELL, HOLD
  confidence  Float
  targetPrice Float?
  stopLoss    Float?
  
  timeframe   String
  strategy    String?
  
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  expiresAt   DateTime?

  @@map("ai_signals")
}
